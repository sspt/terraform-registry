{% extends "base.html" %}

{% block content %}
    <header class="module-header">
        <div class="container">
            <!-- Breadcrumbs -->
            <div style="display: flex; gap: 0.5rem; font-size: 0.875rem; color: var(--text-muted); margin-bottom: 0.5rem; align-items: center;">
                <a href="/" style="text-decoration: none; color: inherit;">Registry Home</a> 
                <span>&gt;</span> 
                <a href="/provider/{{ provider }}" style="text-decoration: none; color: inherit; text-transform: capitalize;">{{ provider }}</a> 
                <span>&gt;</span>
                <a href="/provider/{{ provider }}/{{ group_slug }}" style="text-decoration: none; color: inherit;">{{ group }}</a>
                <span>&gt;</span>
                <a href="/provider/{{ provider }}/{{ group_slug }}/{{ parent_slug }}" style="text-decoration: none; color: inherit;">{{ parent }}</a>
                <span>&gt;</span> 
                <span>{{ name }}</span>
            </div>
            
            <div style="display: flex; flex-wrap: wrap; align-items: baseline; gap: 1rem; margin-bottom: 1rem;">
                <h1 style="font-size: 2.5rem; margin: 0; color: var(--primary-color);">{{ name }}</h1>
                <div style="display: flex; align-items: center; gap: 0.5rem;">
                    <select id="version-select" onchange="window.location.href='?version='+this.value" style="width: auto; padding-right: 2rem; font-weight: 600;">
                        {% for v in versions %}
                            <option value="{{ v.version }}" {% if current_version == v.version or (not current_version and loop.first) %}selected{% endif %}>{{ v.version }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>
            
            <p style="font-size: 1.125rem; color: var(--text-muted); max-width: 800px; margin-bottom: 2rem;">{{ details.description }}</p>
            
            <div style="margin-bottom: 0;">
                <h4 style="font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.05em; color: var(--text-muted); margin-bottom: 0.5rem;">Usage</h4>
                <div style="border: 1px solid var(--border-color); background: var(--bg-surface); border-radius: var(--radius-md); padding: 1rem;">
                    <pre style="margin: 0; background: transparent; padding: 0; border: none; overflow-x: auto; color: var(--text-main);"><code style="font-family: var(--font-mono); font-size: 0.9em;">module "{{ name }}" {
  source  = "{{ request.base_url.hostname }}{% if request.base_url.port %}:{{ request.base_url.port }}{% endif %}/{{ namespace }}/{{ name }}/{{ provider }}"
  version = "{{ current_version if current_version else (versions[0].version if versions else 'x.y.z') }}"
  # insert required variables here
}</code></pre>
                </div>
            </div>
        </div>
    </header>

    <div class="container" style="margin-top: 2rem; margin-bottom: 4rem;">
        <div class="grid" style="grid-template-columns: 1fr; gap: 3rem;">
            <!-- Main Content: README -->
            <article>
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; padding-bottom: 1rem; border-bottom: 1px solid var(--border-color);">
                    <h2 style="font-size: 1.5rem; margin: 0;">Documentation</h2>
                    <!-- Examples Dropdown (only if exists) -->
                    {% if examples %}
                    <div style="position: relative;">
                         <details style="margin:0; border: none; background: transparent;">
                            <summary class="btn-secondary" style="cursor: pointer;">
                                View Examples
                            </summary>
                            <div style="position: absolute; right: 0; top: 100%; width: 220px; background: var(--bg-surface); border: 1px solid var(--border-color); box-shadow: var(--shadow-lg); border-radius: var(--radius-md); z-index: 10; padding: 0.5rem; margin-top: 0.5rem;">
                                <ul style="list-style: none; padding: 0;">
                                {% for example in examples %}
                                    <li><a href="{{ example.url }}" target="_blank" style="display: block; padding: 0.5rem; text-decoration: none; border-radius: var(--radius-sm); color: var(--text-main);">{{ example.name }}</a></li>
                                {% endfor %}
                                </ul>
                            </div>
                        </details>
                    </div>
                    {% endif %}
                </div>

                {% if readme %}
                    <div class="markdown-body">
                        {{ readme | safe }}
                    </div>
                {% else %}
                    <div style="text-align: center; padding: 4rem; background: var(--bg-surface-alt); border-radius: var(--radius-md);">
                        <p class="text-muted">No README documentation found for this module.</p>
                        <a href="{{ details.html_url }}" class="btn-primary" target="_blank" style="margin-top: 1rem;">Browse Source Code</a>
                    </div>
                {% endif %}
            </article>
        </div>
    </div>
{% endblock %}
